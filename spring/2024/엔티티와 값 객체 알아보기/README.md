[저번 시간](https://elsethrow.com/2024/11/25/%EC%97%94%ED%8B%B0%ED%8B%B0-%EC%A0%95%EB%A6%AC-%EB%B0%8F-%EC%9A%94%EC%95%BD/)에는 엔티티에 대해 알아보았는데요. 이번 포스팅에는 엔티티와 값 객체에 대해 작성하려고 합니다. 포스팅은 도서 <단위 테스트>의 저자 블라디미르 코리코프의 "Entity vs Value Object: the ultimate list of differences" 포스팅을 재구성하여 작성하였습니다. 

들어가기에 앞서 명칭에 대한 정리를 하고자 합니다. '값 객체'에 대해 Value Object라고 하기도 하고 Vo라고 부르기도 합니다. 그러나 해당 포스팅에서는 '값 객체'로 명칭을 통일하겠습니다.

## 1. 엔티티 대 값 객체: 같다는 기준 (Entity vs Value Object: types of equality)
엔티티와 값 객체가 첫 번째로 차이를 보이는 곳은 _같다고 비교하는_ 것에서 차이를 보인다.

> 동등성이 영어로 equality인데, 뒤에 나오겠지만 Reference Equlity도 equlity로 표현하므로 조금 더 포괄적인 의미로 받아드려 '같음'이라 번역하였습니다.
> 
> 또한 이전 시간에 [동등성과 동일성 자바로 이해하기
](https://elsethrow.com/2024/10/03/%EB%8F%99%EB%93%B1%EC%84%B1%EA%B3%BC-%EB%8F%99%EC%9D%BC%EC%84%B1-%EC%9E%90%EB%B0%94%EB%A1%9C-%EC%9D%B4%ED%95%B4%ED%95%98%EA%B8%B0/) 란 포스팅에서 동일성과 동등성에 대해 자세하게 다뤘으니 참고하면 좋습니다.

이를 비교하기 전에 '같음'을 비교하는 것에는 세 가지 구분이 존재한다.

### 참조가 같음(Reference equality)
서로 다른 두 객체가 같은 참조를 바라볼 때 우리는 이 두 객체를 같다고 한다.

[그림]
```
var green = new Color(0, 255, 0); // r: 0, g: 255, b: 0
var anotherGreen = green;
green == anotherGreen; // true
```

> 이렇게 같은 참조를 바라볼 때(동일성) 동일하다고도 한다.

### 식별자가 같음(Identifier equality)
클래스에 ID와 같은 필드가 있을 때, 서로 다른 두 클래스의 객체는 식별자가 같으면 같다고 한다.

[그림]

### 구조적인 같음(Structural equality)
마지막으로 우리는 서로 다른 두 객체의 멤버가 모두 같을 때 같다고 한다. 이를 동등하다고도(동등성) 표현한다.

[그림]

엔티티와 값 객체의 중요한 차이점은 객체를 서로 비교하는 방식에 있다. **엔티티는 식별자가 같으면 같다고 표현하고 값 객체는 구조적으로 같으면 같다고 표현**한다. 즉, 엔티티는 ID를 가지고 있지만 값 객체는 그렇지 않다.

서로 다른 두 값 객체의 멤버가 모두 같다면 서로 교환되어도 문제가 없는 것이다. 예를 들어 A에게 있는 '돈 5천원'의 값 객체를 B에게 넘겨도 5천원의 가치는 불변하니 서로 바꿔 취급할 수 있다.

하지만 엔티티는 사뭇 다르다. 예를 들어 서로 다른 A, B가 이름과 성별 나이도 동일해도 ID가 다르다면 두 엔티티는 같다고 보지 않는다.


## 2. 엔티티 대 값 객체: 생명주기(Entity vs Value Object: lifespan)
두 번째 차이점은 생명 주기이다. 엔티티는 연속적인 상태로 존재한다. 엔티티는 저장하지 않더라도 생명주기 동안 히스토리를 가지고 있다.

하지만 값 객체는 생명 주기가 없다. 쉽게 생성하고 파괴할 수 있다. 기존 것을 버리고 새롭게 생성해 교체 해버릴 수도 있다.

따라서 값 객체는 단독으로 존재할 수 없으며 항상 하나 또는 여러 개의 엔티티에 속해야 한다. 엔티티가 값 객체를 참조할 때 비로소 값 객체는 의미를 갖는다.

또한 값 객체는 별도로 저장하지 않는다. 값 객체를 저장하는 유일한 방법은 엔티티에 첨부하여 저장하는 것이다.

"돈이 얼마인가요?"라는 문장과 "A가 가진 돈은 얼마인가요?"나 "모든 사용자가 가진 돈을 얼마인가요?"라는 문장을 보자. 값 객체의 의미를 이해할 수 있을 것이다.

## 3. 엔티티 대 값 객체: 불변성(Entity vs Value Object: immutability)
세 번째 차이점은 불변성이다. 값 객체는 불변해야 한다. 값 객체를 수정해야 해야할 때를 보면 알 수 있는데, 일부 필드만 변경하지 않고 새로운 인스턴스를 생성하여 아예 교체한다. 반대로 엔티티는 항상 변경이 가능하다.

값 객체가 변경될 수 있다면 그 객체에 고유한 생명 주기가 있다고 가정하게 된다. 이런 가정은 결국 값 객체가 고유한 정체성을 가지고 있다는 결론으로 이어지며, 이는 DDD 개념의 정의와 모순된다.

값 객체가 불변이 아니라면 그것은 값 객체가 아니다.

## 4. 도메인 모델에서 값 객체를 인식하는 방법은 무엇일까? (How to recognize a value object in your domain model?)

## 5. How to store value objects in the database?

## 6. Prefer value objects over entities

## 7. Summary
